import{d as be,q as ke,c as $,a as p,b as l,w as a,x as u,t as b,j as L,C as Ce,G as Q,y as N,k as d,Y as k,f as n,H as Fe,o as f,F as De,r as Ve,z as B,v as xe,e as T,U as he,E as v,Q as ze,V as Ue,_ as $e}from"./index-D53lTjIk.js";import{u as Be}from"./servers-CvzP1gNB.js";const Me={class:"file-manager"},Re={class:"file-toolbar"},Pe={class:"toolbar-left"},Ae={class:"page-title"},Ee={class:"toolbar-actions"},Le={class:"path-nav"},Ne={class:"file-list"},Te={class:"file-name"},je={class:"permissions"},Se={key:0,class:"empty-state"},He=be({__name:"FileManager",setup(Ke){const W=Ue(),j=Be(),m=N(()=>Number(W.params.id)),S=N(()=>j.servers.get(m.value)),s=d("/"),h=d("/"),M=d([]),z=d(!1),H=N(()=>s.value.split("/").filter(Boolean));function J(t){return"/"+H.value.slice(0,t+1).join("/")}function X(t){if(t===0)return"0 B";const e=["B","KB","MB","GB","TB"],c=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,c)).toFixed(1)+" "+e[c]}function Z(t){return he(t).format("YYYY-MM-DD HH:mm")}async function R(t){z.value=!0;try{const e=await k.listDirectory(m.value,t);M.value=e.data.files||[],s.value=t,h.value=t}catch{}finally{z.value=!1}}function C(t){R(t.startsWith("/")?t:"/"+t)}function ee(){const t=s.value.split("/").filter(Boolean);t.pop(),C("/"+t.join("/"))}function F(){R(s.value)}function le(t){if(t.type==="directory"){const e=s.value==="/"?"/"+t.name:s.value+"/"+t.name;C(e)}}function te(t,e,c){c.preventDefault()}async function ae(t){try{const e=s.value==="/"?"/"+t.name:s.value+"/"+t.name,c=await k.download(m.value,e),i=new Blob([c]),r=window.URL.createObjectURL(i),w=document.createElement("a");w.href=r,w.download=t.name,w.click(),window.URL.revokeObjectURL(r),v.success("下载已开始")}catch{}}async function oe(t){await ze.confirm(`确定要删除 ${t.name} 吗？${t.type==="directory"?"（将删除该目录下所有文件）":""}`,"确认删除",{type:"warning"});try{const e=s.value==="/"?"/"+t.name:s.value+"/"+t.name;await k.delete(m.value,e,t.type==="directory"),v.success("删除成功"),F()}catch{}}const D=d(!1),_=d(""),P=d(!1);async function K(){if(!_.value.trim()){v.warning("请输入文件夹名称");return}P.value=!0;try{const t=s.value==="/"?"/"+_.value:s.value+"/"+_.value;await k.createDirectory(m.value,t),v.success("创建成功"),D.value=!1,_.value="",F()}catch{}finally{P.value=!1}}const V=d(!1),U=d(null),y=d(""),A=d(!1);function ne(t){U.value=t,y.value=t.name,V.value=!0}async function Y(){if(!y.value.trim()||!U.value){v.warning("请输入新名称");return}A.value=!0;try{const t=s.value==="/"?"/"+U.value.name:s.value+"/"+U.value.name,e=s.value==="/"?"/"+y.value:s.value+"/"+y.value;await k.rename(m.value,t,e),v.success("重命名成功"),V.value=!1,F()}catch{}finally{A.value=!1}}async function se(t){const e=t.file;try{await k.upload(m.value,s.value+"/",e),v.success(`${e.name} 上传成功`),F()}catch{}}return ke(async()=>{S.value||await j.fetchServers(),R("/")}),(t,e)=>{var G;const c=n("ArrowLeft"),i=n("el-icon"),r=n("el-button"),w=n("FolderOpened"),ue=n("Top"),ie=n("Refresh"),re=n("FolderAdd"),de=n("Upload"),ce=n("el-upload"),me=n("HomeFilled"),O=n("el-breadcrumb-item"),pe=n("el-breadcrumb"),E=n("el-input"),I=n("Folder"),fe=n("Document"),g=n("el-table-column"),ve=n("Download"),_e=n("Edit"),ye=n("Delete"),we=n("el-table"),q=n("el-dialog"),ge=Fe("loading");return f(),$("div",Me,[p("div",Re,[p("div",Pe,[l(r,{text:"",onClick:e[0]||(e[0]=o=>t.$router.push(`/server/${m.value}`))},{default:a(()=>[l(i,null,{default:a(()=>[l(c)]),_:1}),e[11]||(e[11]=u(" 返回 ",-1))]),_:1}),p("span",Ae,[l(i,null,{default:a(()=>[l(w)]),_:1}),u(" 文件管理 - "+b((G=S.value)==null?void 0:G.name),1)])]),p("div",Ee,[l(r,{size:"small",onClick:ee,disabled:s.value==="/"},{default:a(()=>[l(i,null,{default:a(()=>[l(ue)]),_:1}),e[12]||(e[12]=u(" 上级目录 ",-1))]),_:1},8,["disabled"]),l(r,{size:"small",onClick:F},{default:a(()=>[l(i,null,{default:a(()=>[l(ie)]),_:1}),e[13]||(e[13]=u(" 刷新 ",-1))]),_:1}),l(r,{size:"small",type:"primary",onClick:e[1]||(e[1]=o=>D.value=!0)},{default:a(()=>[l(i,null,{default:a(()=>[l(re)]),_:1}),e[14]||(e[14]=u(" 新建文件夹 ",-1))]),_:1}),l(ce,{ref:"uploadRef",action:"","http-request":se,"show-file-list":!1,multiple:""},{default:a(()=>[l(r,{size:"small",type:"primary"},{default:a(()=>[l(i,null,{default:a(()=>[l(de)]),_:1}),e[15]||(e[15]=u(" 上传文件 ",-1))]),_:1})]),_:1},512)])]),p("div",Le,[l(pe,{separator:"/"},{default:a(()=>[l(O,{onClick:e[2]||(e[2]=o=>C("/"))},{default:a(()=>[l(i,null,{default:a(()=>[l(me)]),_:1})]),_:1}),(f(!0),$(De,null,Ve(H.value,(o,x)=>(f(),B(O,{key:x,onClick:Ye=>C(J(x))},{default:a(()=>[u(b(o),1)]),_:2},1032,["onClick"]))),128))]),_:1}),l(E,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=o=>h.value=o),placeholder:"输入路径...",size:"small",class:"path-input",onKeyup:e[4]||(e[4]=L(o=>C(h.value),["enter"]))},{prefix:a(()=>[l(i,null,{default:a(()=>[l(w)]),_:1})]),_:1},8,["modelValue"])]),Ce((f(),$("div",Ne,[l(we,{data:M.value,onRowDblclick:le,onRowContextmenu:te,"highlight-current-row":"",class:"file-table"},{default:a(()=>[l(g,{width:"50"},{default:a(({row:o})=>[l(i,{size:24,class:xe(["file-icon",o.type])},{default:a(()=>[o.type==="directory"?(f(),B(I,{key:0})):(f(),B(fe,{key:1}))]),_:2},1032,["class"])]),_:1}),l(g,{prop:"name",label:"名称",sortable:""},{default:a(({row:o})=>[p("span",Te,b(o.name),1)]),_:1}),l(g,{prop:"size",label:"大小",width:"120",sortable:""},{default:a(({row:o})=>[u(b(o.type==="directory"?"-":X(o.size)),1)]),_:1}),l(g,{prop:"permissions",label:"权限",width:"120"},{default:a(({row:o})=>[p("code",je,b(o.permissions),1)]),_:1}),l(g,{prop:"modifiedAt",label:"修改时间",width:"180",sortable:""},{default:a(({row:o})=>[u(b(Z(o.modifiedAt)),1)]),_:1}),l(g,{label:"操作",width:"200",fixed:"right"},{default:a(({row:o})=>[o.type!=="directory"?(f(),B(r,{key:0,type:"primary",text:"",size:"small",onClick:T(x=>ae(o),["stop"])},{default:a(()=>[l(i,null,{default:a(()=>[l(ve)]),_:1}),e[16]||(e[16]=u(" 下载 ",-1))]),_:1},8,["onClick"])):Q("",!0),l(r,{type:"primary",text:"",size:"small",onClick:T(x=>ne(o),["stop"])},{default:a(()=>[l(i,null,{default:a(()=>[l(_e)]),_:1}),e[17]||(e[17]=u(" 重命名 ",-1))]),_:1},8,["onClick"]),l(r,{type:"danger",text:"",size:"small",onClick:T(x=>oe(o),["stop"])},{default:a(()=>[l(i,null,{default:a(()=>[l(ye)]),_:1}),e[18]||(e[18]=u(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),M.value.length===0&&!z.value?(f(),$("div",Se,[l(i,{size:48},{default:a(()=>[l(I)]),_:1}),e[19]||(e[19]=p("p",null,"该目录为空",-1))])):Q("",!0)])),[[ge,z.value]]),l(q,{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=o=>D.value=o),title:"新建文件夹",width:"400px"},{footer:a(()=>[l(r,{onClick:e[6]||(e[6]=o=>D.value=!1)},{default:a(()=>[...e[20]||(e[20]=[u("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:K,loading:P.value},{default:a(()=>[...e[21]||(e[21]=[u("创建",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(E,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=o=>_.value=o),placeholder:"请输入文件夹名称",onKeyup:L(K,["enter"])},null,8,["modelValue"])]),_:1},8,["modelValue"]),l(q,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=o=>V.value=o),title:"重命名",width:"400px"},{footer:a(()=>[l(r,{onClick:e[9]||(e[9]=o=>V.value=!1)},{default:a(()=>[...e[22]||(e[22]=[u("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:Y,loading:A.value},{default:a(()=>[...e[23]||(e[23]=[u("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(E,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=o=>y.value=o),placeholder:"请输入新名称",onKeyup:L(Y,["enter"])},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}}),qe=$e(He,[["__scopeId","data-v-7621f43c"]]);export{qe as default};
