import{d as Fe,c as _,a as o,b as l,w as s,h as p,B as re,C as Ie,D as Ne,G,y as N,k as b,f as u,H as De,o as r,F as K,r as J,z as me,n as D,x as d,t as m,I as Be,v as w,m as pe,J as Le,K as Re,L as Me,M as qe,N as Ee,O as He,e as Ge,P as Ke,p as fe,E as A,Q as ce,R as _e,g as Je,_ as Oe}from"./index-D53lTjIk.js";import{u as Qe}from"./servers-CvzP1gNB.js";const je={class:"dashboard"},We={class:"toolbar"},Xe={class:"toolbar-left"},Ye={class:"group-count"},Ze={class:"toolbar-right"},el={class:"server-grid"},ll=["onClick"],tl={class:"card-header"},sl={class:"server-icon"},al={class:"server-info"},ol={class:"server-name"},nl={class:"server-ip"},dl={key:0,class:"metrics"},ul={class:"metric-item"},il={class:"metric-header"},rl={class:"metric-value tech-number"},ml={class:"tech-progress"},pl={class:"metric-item"},fl={class:"metric-header"},cl={class:"metric-value tech-number"},_l={class:"tech-progress"},vl={key:0,class:"metric-item"},bl={class:"metric-header"},gl={class:"metric-value tech-number"},hl={class:"tech-progress"},yl={key:1,class:"offline-info"},wl={key:0,class:"empty-state"},Vl={key:0,class:"scan-results"},kl=Fe({__name:"Dashboard",setup(Cl){const B=Je(),V=Qe(),O=N(()=>V.loading),ve=N(()=>V.serverList),Q=N(()=>V.groups),T=b(null),$=b(""),P=b(""),j=N(()=>{let n=ve.value;if(T.value&&(n=n.filter(e=>e.group_id===T.value)),P.value&&(n=n.filter(e=>e.status===P.value)),$.value){const e=$.value.toLowerCase();n=n.filter(i=>{var S;return i.name.toLowerCase().includes(e)||i.ip.includes(e)||((S=i.hostname)==null?void 0:S.toLowerCase().includes(e))})}return n});function be(n){return{online:"正常",warning:"警告",error:"异常",offline:"离线"}[n]||"未知"}function L(n){return n>=90?"high":n>=70?"medium":"low"}function R(n){if(n==null)return"0.0";const e=Number(n);return isNaN(e)?"0.0":e.toFixed(1)}function ge(n){B.push(`/server/${n}`)}function he(n){B.push(`/terminal/${n}`)}function ye(n){B.push(`/files/${n}`)}const g=b(!1),k=b(null),W=b(),M=b(!1),a=fe({name:"",ip:"",sshPort:22,sshUser:"root",sshAuthType:"password",sshCredential:"",groupId:null,notes:""}),we={name:[{required:!0,message:"请输入服务器名称",trigger:"blur"}],ip:[{required:!0,message:"请输入IP地址",trigger:"blur"}],sshUser:[{required:!0,message:"请输入用户名",trigger:"blur"}],sshCredential:[{required:!0,message:"请输入密码或私钥",trigger:"blur"}]};async function Ve(){var e;if(await((e=W.value)==null?void 0:e.validate().catch(()=>!1))){M.value=!0;try{k.value?(await V.updateServer(k.value.id,a),A.success("更新成功")):(await V.addServer(a),A.success("添加成功")),g.value=!1,ke()}catch{}finally{M.value=!1}}}function ke(){k.value=null,a.name="",a.ip="",a.sshPort=22,a.sshUser="root",a.sshAuthType="password",a.sshCredential="",a.groupId=null,a.notes=""}function Ce(n,e){switch(n){case"edit":k.value=e,a.name=e.name,a.ip=e.ip,a.sshPort=e.ssh_port,a.sshUser=e.ssh_user,a.sshAuthType=e.ssh_auth_type,a.sshCredential="",a.groupId=e.group_id||null,a.notes=e.notes||"",g.value=!0;break;case"reboot":ce.confirm("确定要重启该服务器吗？","确认重启",{type:"warning"}).then(async()=>{try{await _e.reboot(e.id),A.success("重启命令已发送")}catch{}}).catch(()=>{});break;case"delete":ce.confirm("确定要删除该服务器吗？","确认删除",{type:"warning"}).then(async()=>{await V.deleteServer(e.id),A.success("删除成功")}).catch(()=>{});break}}const U=b(!1),z=b(!1),C=b([]),y=fe({subnet:"192.168.1.0/24",ports:"22"});async function Ue(){z.value=!0,C.value=[];try{const n=y.ports.split(",").map(i=>parseInt(i.trim())).filter(i=>!isNaN(i)),e=await _e.scan(y.subnet,n);C.value=e.data.found||[],C.value.length===0&&A.info("未发现可用设备")}catch{}finally{z.value=!1}}function Se(n){a.ip=n.ip,a.name=n.hostname||n.ip,U.value=!1,g.value=!0}return(n,e)=>{const i=u("el-option"),S=u("el-select"),h=u("el-input"),x=u("el-radio-button"),X=u("el-radio-group"),f=u("el-icon"),c=u("el-button"),q=u("el-tooltip"),E=u("el-dropdown-item"),xe=u("el-dropdown-menu"),Ae=u("el-dropdown"),v=u("el-form-item"),Te=u("el-input-number"),Y=u("el-radio"),Z=u("el-form"),ee=u("el-dialog"),F=u("el-table-column"),$e=u("el-tag"),Pe=u("el-table"),ze=De("loading");return r(),_("div",je,[o("div",We,[o("div",Xe,[l(S,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=t=>T.value=t),placeholder:"全部分组",clearable:"",class:"group-select"},{default:s(()=>[l(i,{label:"全部分组",value:null}),(r(!0),_(K,null,J(Q.value,t=>(r(),me(i,{key:t.id,label:t.name,value:t.id},{default:s(()=>[o("span",{class:"group-color",style:D({background:t.color})},null,4),d(" "+m(t.name)+" ",1),o("span",Ye,"("+m(t.server_count)+")",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),l(h,{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=t=>$.value=t),placeholder:"搜索服务器名称或IP...",clearable:"",class:"search-input","prefix-icon":p(re)},null,8,["modelValue","prefix-icon"]),l(X,{modelValue:P.value,"onUpdate:modelValue":e[2]||(e[2]=t=>P.value=t),class:"status-filter"},{default:s(()=>[l(x,{label:""},{default:s(()=>[...e[21]||(e[21]=[d("全部",-1)])]),_:1}),l(x,{label:"online"},{default:s(()=>[...e[22]||(e[22]=[d("在线",-1)])]),_:1}),l(x,{label:"warning"},{default:s(()=>[...e[23]||(e[23]=[d("警告",-1)])]),_:1}),l(x,{label:"error"},{default:s(()=>[...e[24]||(e[24]=[d("异常",-1)])]),_:1}),l(x,{label:"offline"},{default:s(()=>[...e[25]||(e[25]=[d("离线",-1)])]),_:1})]),_:1},8,["modelValue"])]),o("div",Ze,[l(c,{type:"primary",onClick:e[3]||(e[3]=t=>U.value=!0)},{default:s(()=>[l(f,null,{default:s(()=>[l(p(re))]),_:1}),e[26]||(e[26]=d(" 扫描网段 ",-1))]),_:1}),l(c,{type:"primary",onClick:e[4]||(e[4]=t=>g.value=!0)},{default:s(()=>[l(f,null,{default:s(()=>[l(p(Be))]),_:1}),e[27]||(e[27]=d(" 添加服务器 ",-1))]),_:1})])]),Ie((r(),_("div",el,[l(Ne,{name:"server-list"},{default:s(()=>[(r(!0),_(K,null,J(j.value,t=>{var H,le,te,se,ae,oe,ne,de,ue,ie;return r(),_("div",{key:t.id,class:w(["server-card tech-card",[`status-${t.status}`]]),onClick:I=>ge(t.id)},[o("div",{class:w(["status-bar",t.status])},null,2),o("div",tl,[o("div",sl,[l(f,{size:36},{default:s(()=>[l(p(pe))]),_:1})]),o("div",al,[o("h3",ol,m(t.name),1),o("span",nl,m(t.ip),1)]),o("div",{class:w(["status-badge",t.status])},[o("span",{class:w(["status-indicator",t.status])},null,2),d(" "+m(be(t.status)),1)],2)]),t.status==="online"||t.status==="warning"?(r(),_("div",dl,[o("div",ul,[o("div",il,[e[28]||(e[28]=o("span",{class:"metric-label"},"CPU",-1)),o("span",rl,m(R((H=t.metrics)==null?void 0:H.cpuUsage))+"%",1)]),o("div",ml,[o("div",{class:w(["progress-bar",L(((le=t.metrics)==null?void 0:le.cpuUsage)||0)]),style:D({width:`${((te=t.metrics)==null?void 0:te.cpuUsage)||0}%`})},null,6)])]),o("div",pl,[o("div",fl,[e[29]||(e[29]=o("span",{class:"metric-label"},"内存",-1)),o("span",cl,m(R((se=t.metrics)==null?void 0:se.memoryUsage))+"%",1)]),o("div",_l,[o("div",{class:w(["progress-bar",L(((ae=t.metrics)==null?void 0:ae.memoryUsage)||0)]),style:D({width:`${((oe=t.metrics)==null?void 0:oe.memoryUsage)||0}%`})},null,6)])]),(ne=t.metrics)!=null&&ne.diskUsage?(r(),_("div",vl,[o("div",bl,[e[30]||(e[30]=o("span",{class:"metric-label"},"磁盘",-1)),o("span",gl,m(R((de=t.metrics)==null?void 0:de.diskUsage))+"%",1)]),o("div",hl,[o("div",{class:w(["progress-bar",L(((ue=t.metrics)==null?void 0:ue.diskUsage)||0)]),style:D({width:`${((ie=t.metrics)==null?void 0:ie.diskUsage)||0}%`})},null,6)])])):G("",!0)])):(r(),_("div",yl,[l(f,{size:32,class:"offline-icon"},{default:s(()=>[l(p(Le))]),_:1}),o("span",null,m(t.status==="error"?"连接异常":"服务器离线"),1)])),o("div",{class:"card-actions",onClick:e[5]||(e[5]=Ge(()=>{},["stop"]))},[l(q,{content:"SSH终端"},{default:s(()=>[l(c,{circle:"",size:"small",onClick:I=>he(t.id),disabled:t.status==="offline"||t.status==="error"},{default:s(()=>[l(f,null,{default:s(()=>[l(p(pe))]),_:1})]),_:1},8,["onClick","disabled"])]),_:2},1024),l(q,{content:"文件管理"},{default:s(()=>[l(c,{circle:"",size:"small",onClick:I=>ye(t.id),disabled:t.status==="offline"||t.status==="error"},{default:s(()=>[l(f,null,{default:s(()=>[l(p(Re))]),_:1})]),_:1},8,["onClick","disabled"])]),_:2},1024),l(q,{content:"更多操作"},{default:s(()=>[l(Ae,{trigger:"click",onCommand:I=>Ce(I,t)},{dropdown:s(()=>[l(xe,null,{default:s(()=>[l(E,{command:"edit"},{default:s(()=>[l(f,null,{default:s(()=>[l(p(qe))]),_:1}),e[31]||(e[31]=d("编辑 ",-1))]),_:1}),l(E,{command:"reboot",disabled:t.status==="offline"},{default:s(()=>[l(f,null,{default:s(()=>[l(p(Ee))]),_:1}),e[32]||(e[32]=d("重启 ",-1))]),_:1},8,["disabled"]),l(E,{command:"delete",divided:""},{default:s(()=>[l(f,null,{default:s(()=>[l(p(He))]),_:1}),e[33]||(e[33]=d("删除 ",-1))]),_:1})]),_:2},1024)]),default:s(()=>[l(c,{circle:"",size:"small"},{default:s(()=>[l(f,null,{default:s(()=>[l(p(Me))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:2},1024)])],10,ll)}),128))]),_:1}),j.value.length===0&&!O.value?(r(),_("div",wl,[l(f,{size:64},{default:s(()=>[l(p(Ke))]),_:1}),e[35]||(e[35]=o("p",null,"暂无服务器",-1)),l(c,{type:"primary",onClick:e[6]||(e[6]=t=>g.value=!0)},{default:s(()=>[...e[34]||(e[34]=[d("添加服务器",-1)])]),_:1})])):G("",!0)])),[[ze,O.value]]),l(ee,{modelValue:g.value,"onUpdate:modelValue":e[16]||(e[16]=t=>g.value=t),title:k.value?"编辑服务器":"添加服务器",width:"500px",class:"tech-dialog"},{footer:s(()=>[l(c,{onClick:e[15]||(e[15]=t=>g.value=!1)},{default:s(()=>[...e[38]||(e[38]=[d("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:Ve,loading:M.value},{default:s(()=>[d(m(k.value?"保存":"添加"),1)]),_:1},8,["loading"])]),default:s(()=>[l(Z,{ref_key:"serverFormRef",ref:W,model:a,rules:we,"label-width":"100px"},{default:s(()=>[l(v,{label:"服务器名称",prop:"name"},{default:s(()=>[l(h,{modelValue:a.name,"onUpdate:modelValue":e[7]||(e[7]=t=>a.name=t),placeholder:"请输入服务器名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"IP地址",prop:"ip"},{default:s(()=>[l(h,{modelValue:a.ip,"onUpdate:modelValue":e[8]||(e[8]=t=>a.ip=t),placeholder:"192.168.1.100"},null,8,["modelValue"])]),_:1}),l(v,{label:"SSH端口",prop:"sshPort"},{default:s(()=>[l(Te,{modelValue:a.sshPort,"onUpdate:modelValue":e[9]||(e[9]=t=>a.sshPort=t),min:1,max:65535},null,8,["modelValue"])]),_:1}),l(v,{label:"用户名",prop:"sshUser"},{default:s(()=>[l(h,{modelValue:a.sshUser,"onUpdate:modelValue":e[10]||(e[10]=t=>a.sshUser=t),placeholder:"root"},null,8,["modelValue"])]),_:1}),l(v,{label:"认证方式",prop:"sshAuthType"},{default:s(()=>[l(X,{modelValue:a.sshAuthType,"onUpdate:modelValue":e[11]||(e[11]=t=>a.sshAuthType=t)},{default:s(()=>[l(Y,{label:"password"},{default:s(()=>[...e[36]||(e[36]=[d("密码",-1)])]),_:1}),l(Y,{label:"key"},{default:s(()=>[...e[37]||(e[37]=[d("密钥",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:a.sshAuthType==="password"?"密码":"私钥",prop:"sshCredential"},{default:s(()=>[l(h,{modelValue:a.sshCredential,"onUpdate:modelValue":e[12]||(e[12]=t=>a.sshCredential=t),type:a.sshAuthType==="password"?"password":"textarea",rows:4,placeholder:a.sshAuthType==="password"?"请输入密码":"请粘贴私钥内容","show-password":""},null,8,["modelValue","type","placeholder"])]),_:1},8,["label"]),l(v,{label:"分组"},{default:s(()=>[l(S,{modelValue:a.groupId,"onUpdate:modelValue":e[13]||(e[13]=t=>a.groupId=t),placeholder:"选择分组",clearable:""},{default:s(()=>[(r(!0),_(K,null,J(Q.value,t=>(r(),me(i,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"备注"},{default:s(()=>[l(h,{modelValue:a.notes,"onUpdate:modelValue":e[14]||(e[14]=t=>a.notes=t),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(ee,{modelValue:U.value,"onUpdate:modelValue":e[20]||(e[20]=t=>U.value=t),title:"扫描网段",width:"600px",class:"tech-dialog"},{footer:s(()=>[l(c,{onClick:e[19]||(e[19]=t=>U.value=!1)},{default:s(()=>[...e[40]||(e[40]=[d("关闭",-1)])]),_:1}),l(c,{type:"primary",onClick:Ue,loading:z.value},{default:s(()=>[d(m(z.value?"扫描中...":"开始扫描"),1)]),_:1},8,["loading"])]),default:s(()=>[l(Z,{model:y,"label-width":"80px"},{default:s(()=>[l(v,{label:"网段"},{default:s(()=>[l(h,{modelValue:y.subnet,"onUpdate:modelValue":e[17]||(e[17]=t=>y.subnet=t),placeholder:"192.168.1.0/24"},null,8,["modelValue"])]),_:1}),l(v,{label:"端口"},{default:s(()=>[l(h,{modelValue:y.ports,"onUpdate:modelValue":e[18]||(e[18]=t=>y.ports=t),placeholder:"22"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),C.value.length>0?(r(),_("div",Vl,[o("h4",null,"发现 "+m(C.value.length)+" 台设备",1),l(Pe,{data:C.value,size:"small"},{default:s(()=>[l(F,{prop:"ip",label:"IP地址"}),l(F,{prop:"hostname",label:"主机名"}),l(F,{prop:"sshAvailable",label:"SSH"},{default:s(({row:t})=>[l($e,{type:t.sshAvailable?"success":"info",size:"small"},{default:s(()=>[d(m(t.sshAvailable?"可用":"不可用"),1)]),_:2},1032,["type"])]),_:1}),l(F,{label:"操作",width:"100"},{default:s(({row:t})=>[l(c,{type:"primary",size:"small",disabled:!t.sshAvailable,onClick:H=>Se(t)},{default:s(()=>[...e[39]||(e[39]=[d(" 添加 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"])])):G("",!0)]),_:1},8,["modelValue"])])}}}),xl=Oe(kl,[["__scopeId","data-v-c852b67d"]]);export{xl as default};
