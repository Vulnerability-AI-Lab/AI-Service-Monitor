import{X as A,k as n,y as i,R as t,Z as k}from"./index-D53lTjIk.js";const U=A("servers",()=>{const a=n(new Map),s=n([]),u=n({total:0,online:0,offline:0,warning:0,error:0}),c=n(!1),l=n(null),v=i(()=>Array.from(a.value.values())),d=i(()=>l.value?a.value.get(l.value):null),f=i(()=>{const e=new Map;e.set(0,[]);for(const r of s.value)e.set(r.id,[]);for(const r of a.value.values()){const o=r.group_id||0;e.has(o)||e.set(o,[]),e.get(o).push(r)}return e});async function p(){try{const e=await t.getOverview();u.value={total:e.data.total,online:e.data.online,offline:e.data.offline,warning:e.data.warning,error:e.data.error}}catch(e){console.error("Failed to fetch overview:",e)}}async function g(){c.value=!0;try{const e=await t.list({pageSize:1e3});a.value.clear();for(const r of e.data.list)a.value.set(r.id,r)}finally{c.value=!1}}async function m(){try{const e=await k.list();s.value=e.data}catch(e){console.error("Failed to fetch groups:",e)}}async function y(e){const r=await t.create(e);return a.value.set(r.data.id,r.data),r.data}async function w(e,r){const o=await t.update(e,r);return a.value.set(e,o.data),o.data}async function S(e){await t.delete(e),a.value.delete(e)}function h(e){const r=a.value.get(e.serverId);r&&(r.metrics={cpuUsage:e.cpu.usage,cpuCores:e.cpu.cores,loadAvg:e.cpu.loadAvg,memoryUsage:e.memory.usage,memoryTotal:e.memory.total,memoryUsed:e.memory.used,memoryAvailable:e.memory.available,diskUsage:e.disk,gpuUsage:e.gpu,topProcesses:e.topProcesses,networkIo:e.network,pingLatency:e.connection.pingLatency??void 0,sshStatus:e.connection.ssh?1:0},e.cpu.usage>80||e.memory.usage>80?r.status="warning":r.status="online",r.last_seen=e.timestamp,a.value.set(e.serverId,{...r}))}return{servers:a,groups:s,overview:u,loading:c,currentServerId:l,serverList:v,currentServer:d,serversByGroup:f,fetchOverview:p,fetchServers:g,fetchGroups:m,addServer:y,updateServer:w,deleteServer:S,updateServerStatus:h}});export{U as u};
