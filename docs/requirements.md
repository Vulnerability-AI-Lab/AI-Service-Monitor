# Linux服务器群监测响应系统 - 需求规格说明书

## 1. 项目概述

### 1.1 项目背景
构建一个基于Web的Linux服务器集群监控与管理系统，通过Windows工作站的网页界面，实现对多台Linux服务器的实时状态监控和远程操作管理。

### 1.2 系统目标
- 实时监控服务器集群的运行状态
- 快速发现并响应服务器异常
- 提供便捷的远程管理操作
- 降低运维人员工作负担

### 1.3 用户角色
| 角色 | 描述 | 权限 |
|------|------|------|
| 管理员 | 系统管理人员 | 全部功能 |
| 运维人员 | 日常运维人员 | 监控、基础操作 |
| 只读用户 | 查看人员 | 仅查看状态 |

---

## 2. 系统架构

### 2.1 整体架构
```
┌─────────────────────────────────────────────────────────────────┐
│                      Windows 工作站                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Web 前端界面                          │   │
│  │  (Vue3/React + WebSocket实时通信 + xterm.js终端)        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    后端服务                              │   │
│  │  (Node.js/Python + WebSocket Server + SSH2 + FTP)       │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                               │
            ┌──────────────────┼──────────────────┐
            │                  │                  │
            ▼                  ▼                  ▼
    ┌──────────────┐   ┌──────────────┐   ┌──────────────┐
    │ Linux Server │   │ Linux Server │   │ Linux Server │
    │   (Agent)    │   │   (Agent)    │   │   (Agent)    │
    └──────────────┘   └──────────────┘   └──────────────┘
```

### 2.2 组件说明
| 组件 | 技术选型 | 职责 |
|------|----------|------|
| Web前端 | Vue3 + Element Plus | 用户界面、数据可视化 |
| 后端服务 | Node.js + Express | API服务、WebSocket服务 |
| 数据存储 | SQLite/PostgreSQL | 服务器配置、历史数据 |
| 服务器Agent | Python/Shell | 采集服务器状态数据 |

---

## 3. 功能需求

### 3.1 服务器管理模块

#### 3.1.1 IP扫描功能
| 需求ID | FR-SM-001 |
|--------|-----------|
| 功能名称 | 一键扫描IP |
| 描述 | 扫描指定网段，自动发现在线的Linux服务器 |
| 输入 | IP网段（如：192.168.1.0/24） |
| 输出 | 在线服务器列表（IP、主机名、操作系统） |
| 优先级 | 高 |

**详细要求：**
- 支持CIDR格式网段输入
- 支持多网段同时扫描
- 扫描时显示进度条
- 扫描结果可批量添加到监控列表
- 自动检测SSH服务可用性

#### 3.1.2 服务器添加功能
| 需求ID | FR-SM-002 |
|--------|-----------|
| 功能名称 | 手动添加服务器 |
| 描述 | 手动输入服务器信息添加到监控列表 |
| 优先级 | 高 |

**输入字段：**
- 服务器名称（必填）
- IP地址（必填）
- SSH端口（默认22）
- SSH用户名（必填）
- SSH认证方式（密码/密钥）
- SSH密码或密钥文件
- 分组标签（可选）
- 备注信息（可选）

#### 3.1.3 服务器删除功能
| 需求ID | FR-SM-003 |
|--------|-----------|
| 功能名称 | 删除服务器 |
| 描述 | 从监控列表中移除服务器 |
| 优先级 | 高 |

**详细要求：**
- 支持单个删除和批量删除
- 删除前需二次确认
- 可选是否保留历史监控数据

#### 3.1.4 服务器分组功能
| 需求ID | FR-SM-004 |
|--------|-----------|
| 功能名称 | 服务器分组管理 |
| 描述 | 对服务器进行分组，便于管理 |
| 优先级 | 中 |

**详细要求：**
- 支持创建、编辑、删除分组
- 服务器可属于多个分组
- 分组可设置不同颜色标识

---

### 3.2 状态监控模块

#### 3.2.1 CPU监控
| 需求ID | FR-MO-001 |
|--------|-----------|
| 功能名称 | CPU状态监控 |
| 描述 | 实时监控服务器CPU使用情况 |
| 优先级 | 高 |

**监控指标：**
- CPU总体使用率（%）
- 各CPU核心使用率
- CPU负载（1分钟/5分钟/15分钟）
- CPU温度（如支持）

**显示方式：**
- 仪表盘形式显示当前使用率
- 折线图显示历史趋势（最近1小时/24小时/7天）

#### 3.2.2 GPU监控
| 需求ID | FR-MO-002 |
|--------|-----------|
| 功能名称 | GPU状态监控 |
| 描述 | 实时监控NVIDIA GPU使用情况 |
| 优先级 | 高 |

**监控指标：**
- GPU使用率（%）
- 显存使用率（已用/总量）
- GPU温度
- GPU功耗
- 运行中的GPU进程

**前置条件：**
- 服务器需安装NVIDIA驱动
- 需安装nvidia-smi工具

#### 3.2.3 内存监控
| 需求ID | FR-MO-003 |
|--------|-----------|
| 功能名称 | 内存状态监控 |
| 描述 | 实时监控服务器内存使用情况 |
| 优先级 | 高 |

**监控指标：**
- 物理内存使用率
- 已用内存/总内存
- 可用内存
- 缓存/缓冲区
- Swap使用情况

#### 3.2.4 进程监控
| 需求ID | FR-MO-004 |
|--------|-----------|
| 功能名称 | 高占用进程监控 |
| 描述 | 显示CPU占用最高的前5个进程 |
| 优先级 | 高 |

**显示信息：**
- 进程ID（PID）
- 进程名称
- 进程用户
- CPU占用率
- 内存占用率
- 运行时长

**扩展功能：**
- 支持远程终止进程
- 支持按内存排序切换

#### 3.2.5 连接状态监控
| 需求ID | FR-MO-005 |
|--------|-----------|
| 功能名称 | 网络连接状态监控 |
| 描述 | 监控Ping和SSH连接状态 |
| 优先级 | 高 |

**监控项：**
| 监控项 | 检测方式 | 正常状态 | 异常状态 |
|--------|----------|----------|----------|
| Ping | ICMP Echo | 响应正常 | 超时/无响应 |
| SSH | SSH连接测试 | 可连接 | 连接失败/超时 |

**显示方式：**
- 绿色：正常
- 红色：异常
- 黄色：警告（响应缓慢）
- 灰色：未知/未检测

#### 3.2.6 磁盘监控
| 需求ID | FR-MO-006 |
|--------|-----------|
| 功能名称 | 磁盘空间监控 |
| 描述 | 监控各挂载点磁盘使用情况 |
| 优先级 | 中 |

**监控指标：**
- 各挂载点使用率
- 已用空间/总空间
- inode使用情况

#### 3.2.7 网络流量监控
| 需求ID | FR-MO-007 |
|--------|-----------|
| 功能名称 | 网络流量监控 |
| 描述 | 监控网络接口流量 |
| 优先级 | 中 |

**监控指标：**
- 网络接口列表
- 入站/出站流量（实时速率）
- 累计流量统计

---

### 3.3 远程操作模块

#### 3.3.1 重启功能
| 需求ID | FR-OP-001 |
|--------|-----------|
| 功能名称 | 远程重启服务器 |
| 描述 | 通过Web界面远程重启服务器 |
| 优先级 | 高 |

**功能要求：**
- 支持立即重启
- 支持延时重启（可设置延时时间）
- 支持定时重启
- 重启前需二次确认
- 支持批量重启（需分组确认）
- 重启后自动检测恢复状态

**安全要求：**
- 需要管理员权限
- 记录操作日志

#### 3.3.2 Ping功能
| 需求ID | FR-OP-002 |
|--------|-----------|
| 功能名称 | Ping命令执行 |
| 描述 | 从工作站向服务器发送Ping请求 |
| 优先级 | 高 |

**功能要求：**
- 支持设置Ping次数
- 实时显示Ping结果
- 显示延迟统计（最小/最大/平均）
- 显示丢包率

#### 3.3.3 SSH终端
| 需求ID | FR-OP-003 |
|--------|-----------|
| 功能名称 | Web SSH终端 |
| 描述 | 在网页中提供SSH终端功能 |
| 优先级 | 高 |

**功能要求：**
- 支持标准SSH终端操作
- 支持终端颜色显示
- 支持终端大小自适应
- 支持复制粘贴
- 支持多标签（多个SSH会话）
- 支持会话保持（断线重连）
- 支持命令历史记录

**技术实现：**
- 前端使用xterm.js
- 后端使用ssh2库
- WebSocket实时通信

#### 3.3.4 FTP文件管理
| 需求ID | FR-OP-004 |
|--------|-----------|
| 功能名称 | SFTP文件管理 |
| 描述 | 通过Web界面管理服务器文件 |
| 优先级 | 高 |

**功能要求：**
- 文件浏览（目录树形式）
- 文件上传（支持拖拽上传）
- 文件下载
- 文件删除
- 文件重命名
- 新建文件夹
- 文件权限修改
- 支持大文件分片上传
- 上传/下载进度显示

#### 3.3.5 命令执行
| 需求ID | FR-OP-005 |
|--------|-----------|
| 功能名称 | 批量命令执行 |
| 描述 | 向多台服务器批量执行命令 |
| 优先级 | 中 |

**功能要求：**
- 选择目标服务器（单台/多台/分组）
- 输入待执行命令
- 并行执行命令
- 实时显示各服务器执行结果
- 支持命令模板保存

---

### 3.4 界面展示模块

#### 3.4.1 服务器总览页面
| 需求ID | FR-UI-001 |
|--------|-----------|
| 功能名称 | 服务器总览界面 |
| 描述 | 以图标形式展示所有服务器状态 |
| 优先级 | 高 |

**界面要求：**
```
┌────────────────────────────────────────────────────────────────┐
│  服务器监控中心                              [扫描] [添加] [设置]│
├────────────────────────────────────────────────────────────────┤
│  分组: [全部] [生产环境] [测试环境] [开发环境]                   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐          │
│   │  🖥️    │  │  🖥️    │  │  🖥️    │  │  🖥️    │          │
│   │ Server1 │  │ Server2 │  │ Server3 │  │ Server4 │          │
│   │ ● 正常  │  │ ● 正常  │  │ ● 异常  │  │ ● 警告  │          │
│   │ CPU:45% │  │ CPU:32% │  │ Ping失败│  │ CPU:89% │          │
│   └─────────┘  └─────────┘  └─────────┘  └─────────┘          │
│                                                                │
│   ┌─────────┐  ┌─────────┐                                    │
│   │  🖥️    │  │   ➕   │                                     │
│   │ Server5 │  │  添加   │                                     │
│   │ ● 正常  │  │ 服务器  │                                     │
│   │ CPU:28% │  │         │                                     │
│   └─────────┘  └─────────┘                                    │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

**状态显示规则：**
| 状态 | 图标颜色 | 触发条件 |
|------|----------|----------|
| 正常 | 绿色 | 所有监控项正常 |
| 警告 | 黄色 | CPU>80% 或 内存>80% 或 磁盘>80% |
| 异常 | 红色 | Ping不通 或 SSH连接失败 |
| 离线 | 灰色 | 服务器关机或网络不可达 |

#### 3.4.2 服务器详情页面
| 需求ID | FR-UI-002 |
|--------|-----------|
| 功能名称 | 服务器详情界面 |
| 描述 | 点击服务器图标后显示详细信息 |
| 优先级 | 高 |

**界面要求：**
```
┌────────────────────────────────────────────────────────────────┐
│  ← 返回    Server1 (192.168.1.100)        [SSH] [FTP] [重启]  │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  基本信息                                                 │ │
│  │  主机名: server1    操作系统: Ubuntu 22.04               │ │
│  │  运行时间: 45天     内核版本: 5.15.0-67                  │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌──────────┐│
│  │ CPU        │ │ GPU         │ │ 内存        │ │ 磁盘     ││
│  │    45%     │ │    78%      │ │    62%      │ │   35%    ││
│  │   [====]   │ │   [=====]   │ │   [====]    │ │  [==]    ││
│  └─────────────┘ └─────────────┘ └─────────────┘ └──────────┘│
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  CPU使用率趋势图（实时更新）                              │ │
│  │  ▁▂▃▄▅▆▇█▇▆▅▄▃▂▁▂▃▄▅▆▇                                   │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  Top 5 进程                                               │ │
│  │  PID   名称          用户    CPU%   内存%                 │ │
│  │  1234  python        root    25.3   12.5                  │ │
│  │  5678  nginx         www     15.2    8.3                  │ │
│  │  ...                                                      │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

**功能区域：**
- 基本信息区：主机名、IP、操作系统、运行时间等
- 状态仪表盘：CPU、GPU、内存、磁盘使用率
- 趋势图表：实时更新的使用率曲线
- 进程列表：Top5 CPU占用进程
- 快捷操作：SSH、FTP、重启等按钮

#### 3.4.3 SSH终端页面
| 需求ID | FR-UI-003 |
|--------|-----------|
| 功能名称 | SSH终端界面 |
| 描述 | Web SSH终端操作界面 |
| 优先级 | 高 |

**界面要求：**
- 全屏模式支持
- 多标签页支持
- 终端字体大小调整
- 终端主题切换（明/暗）
- 快捷键支持

#### 3.4.4 FTP文件管理页面
| 需求ID | FR-UI-004 |
|--------|-----------|
| 功能名称 | 文件管理界面 |
| 描述 | SFTP文件管理操作界面 |
| 优先级 | 高 |

**界面要求：**
```
┌────────────────────────────────────────────────────────────────┐
│  文件管理 - Server1                    [上传] [新建文件夹] [刷新]│
├────────────────────────────────────────────────────────────────┤
│  路径: /home/user/                                      [返回上级]│
├────────────────────────────────────────────────────────────────┤
│  名称              大小      修改时间         权限     操作     │
│  📁 documents     -        2024-01-15      drwxr-x   [下载][删除]│
│  📁 projects      -        2024-01-14      drwxr-x   [下载][删除]│
│  📄 config.json   2.5KB    2024-01-13      -rw-r--   [下载][删除]│
│  📄 script.sh     1.2KB    2024-01-12      -rwxr-x   [下载][删除]│
└────────────────────────────────────────────────────────────────┘
```

---

### 3.5 告警通知模块

#### 3.5.1 告警规则配置
| 需求ID | FR-AL-001 |
|--------|-----------|
| 功能名称 | 告警规则配置 |
| 描述 | 配置触发告警的条件 |
| 优先级 | 中 |

**可配置规则：**
- CPU使用率阈值
- 内存使用率阈值
- 磁盘使用率阈值
- GPU使用率阈值
- Ping延迟阈值
- 连续异常次数

#### 3.5.2 告警通知方式
| 需求ID | FR-AL-002 |
|--------|-----------|
| 功能名称 | 告警通知 |
| 描述 | 异常时发送通知 |
| 优先级 | 中 |

**通知方式：**
- 网页弹窗通知
- 浏览器通知（需授权）
- 声音告警
- 邮件通知（可选）
- 企业微信/钉钉通知（可选）

---

## 4. 非功能需求

### 4.1 性能需求

| 需求ID | NFR-001 |
|--------|---------|
| 名称 | 实时性要求 |
| 描述 | 数据更新延迟 |
| 指标 | 状态数据更新延迟 ≤ 3秒 |

| 需求ID | NFR-002 |
|--------|---------|
| 名称 | 并发支持 |
| 描述 | 同时监控服务器数量 |
| 指标 | 支持同时监控 ≥ 100 台服务器 |

| 需求ID | NFR-003 |
|--------|---------|
| 名称 | 响应时间 |
| 描述 | 页面加载响应时间 |
| 指标 | 首页加载 ≤ 2秒，详情页加载 ≤ 1秒 |

| 需求ID | NFR-004 |
|--------|---------|
| 名称 | 界面流畅性 |
| 描述 | 界面更新不卡顿 |
| 指标 | 图表刷新帧率 ≥ 30fps |

### 4.2 安全需求

| 需求ID | NFR-005 |
|--------|---------|
| 名称 | 用户认证 |
| 描述 | 用户登录认证 |
| 指标 | 支持用户名密码登录，支持会话超时 |

| 需求ID | NFR-006 |
|--------|---------|
| 名称 | 数据加密 |
| 描述 | 敏感数据加密存储和传输 |
| 指标 | SSH凭证加密存储，HTTPS传输 |

| 需求ID | NFR-007 |
|--------|---------|
| 名称 | 操作审计 |
| 描述 | 记录用户操作日志 |
| 指标 | 记录所有敏感操作（重启、命令执行等） |

### 4.3 可用性需求

| 需求ID | NFR-008 |
|--------|---------|
| 名称 | 浏览器兼容 |
| 描述 | 主流浏览器支持 |
| 指标 | Chrome/Firefox/Edge 最新版本 |

| 需求ID | NFR-009 |
|--------|---------|
| 名称 | 响应式布局 |
| 描述 | 适配不同屏幕 |
| 指标 | 支持 1920x1080 及以上分辨率 |

### 4.4 可维护性需求

| 需求ID | NFR-010 |
|--------|---------|
| 名称 | 配置管理 |
| 描述 | 系统配置可修改 |
| 指标 | 配置文件化，支持热更新 |

| 需求ID | NFR-011 |
|--------|---------|
| 名称 | 日志记录 |
| 描述 | 系统运行日志 |
| 指标 | 分级日志（DEBUG/INFO/WARN/ERROR） |

---

## 5. 数据需求

### 5.1 数据模型

#### 服务器信息表 (servers)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| name | VARCHAR(100) | 服务器名称 |
| ip | VARCHAR(45) | IP地址 |
| ssh_port | INT | SSH端口 |
| ssh_user | VARCHAR(50) | SSH用户名 |
| ssh_auth_type | ENUM | 认证方式(password/key) |
| ssh_credential | TEXT | 加密后的凭证 |
| group_id | INT | 分组ID |
| status | ENUM | 状态(online/offline/warning/error) |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 监控数据表 (metrics)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键 |
| server_id | INT | 服务器ID |
| cpu_usage | FLOAT | CPU使用率 |
| memory_usage | FLOAT | 内存使用率 |
| disk_usage | JSON | 磁盘使用率 |
| gpu_usage | FLOAT | GPU使用率 |
| top_processes | JSON | Top5进程 |
| timestamp | DATETIME | 采集时间 |

#### 操作日志表 (operation_logs)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键 |
| user_id | INT | 操作用户ID |
| server_id | INT | 目标服务器ID |
| action | VARCHAR(50) | 操作类型 |
| detail | TEXT | 操作详情 |
| result | ENUM | 结果(success/fail) |
| created_at | DATETIME | 操作时间 |

### 5.2 数据保留策略
- 实时数据：保留最近24小时
- 小时汇总：保留最近30天
- 日汇总：保留最近1年
- 操作日志：永久保留

---

## 6. 接口需求

### 6.1 REST API

#### 服务器管理
```
GET    /api/servers           # 获取服务器列表
POST   /api/servers           # 添加服务器
PUT    /api/servers/:id       # 更新服务器信息
DELETE /api/servers/:id       # 删除服务器
POST   /api/servers/scan      # 扫描网段
```

#### 监控数据
```
GET    /api/servers/:id/status    # 获取服务器实时状态
GET    /api/servers/:id/metrics   # 获取历史监控数据
GET    /api/servers/:id/processes # 获取进程列表
```

#### 远程操作
```
POST   /api/servers/:id/ping      # Ping服务器
POST   /api/servers/:id/reboot    # 重启服务器
POST   /api/servers/:id/command   # 执行命令
```

### 6.2 WebSocket接口
```
WS /ws/status         # 服务器状态实时推送
WS /ws/ssh/:id        # SSH终端连接
WS /ws/sftp/:id       # SFTP文件传输
```

---

## 7. 部署需求

### 7.1 服务端部署（Windows工作站）
- Node.js 18+ 运行环境
- 数据库（SQLite或PostgreSQL）
- 网络访问Linux服务器的能力

### 7.2 客户端部署（Linux服务器）
**方案A：Agent模式（推荐）**
- 部署轻量级Agent程序
- Agent主动上报状态数据
- 需要Python 3.8+ 环境

**方案B：无Agent模式**
- 通过SSH远程执行命令采集数据
- 无需额外部署
- 实时性和性能略低于Agent模式

---

## 8. 开发计划

### 8.1 版本规划

#### v1.0 基础版本
- [x] 需求分析
- [ ] 服务器管理（添加/删除/扫描）
- [ ] 基本监控（CPU/内存/磁盘）
- [ ] Ping/SSH状态检测
- [ ] 服务器总览页面
- [ ] 服务器详情页面

#### v1.1 完善版本
- [ ] GPU监控
- [ ] Web SSH终端
- [ ] SFTP文件管理
- [ ] 进程管理

#### v1.2 增强版本
- [ ] 告警通知
- [ ] 批量命令执行
- [ ] 用户权限管理
- [ ] 操作日志审计

---

## 9. 附录

### 9.1 名词解释
| 术语 | 解释 |
|------|------|
| Agent | 部署在被监控服务器上的数据采集程序 |
| SFTP | SSH File Transfer Protocol，基于SSH的安全文件传输协议 |
| WebSocket | 全双工通信协议，用于实时数据推送 |

### 9.2 参考资料
- xterm.js: https://xtermjs.org/
- ssh2: https://github.com/mscdex/ssh2
- ECharts: https://echarts.apache.org/

---

文档版本: v1.0
创建日期: 2026-02-05
最后更新: 2026-02-05
